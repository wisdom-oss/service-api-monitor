asyncapi: 3.0.0
info:
  title: AWARD API Status Monitor
  version: 1.0.0

servers:
  default:
    host: wisdom-demo.uol.de
    protocol: wss


channels:
  status:
    address: '/api/status/v1/'
    messages:
      subscribe:
        $ref: "#/components/messages/subscribe"
      update:
        $ref: "#/components/messages/statusUpdate"
      error:
        $ref: "#/components/messages/commandError"

operations:
  subscribe:
    action: send
    channel:
      $ref: "#/channels/status"
    messages:
      - $ref: '#/channels/status/messages/subscribe'
  
  receiveUpdates:
    action: receive
    channel:
      $ref: "#/channels/status"
    messages:
      - $ref: "#/channels/status/messages/update"
      - $ref: "#/channels/status/messages/error"
    
components:
  schemas:
    Command:
      type: object
      discriminator: command
      properties: 
        command:
          type: string
        id:
          type:
            - string
            - integer
      required:
        - command
        - id

    subscribe:
      description: command to subscribe to status updates
      examples:
        - command: subscribe
          data:
            paths:
              - "/api/dwd"
      allOf:
        - $ref: "#/components/schemas/Command"
        - type: object
          properties: 
            data:
              type: object
              required:
                - paths
              properties: 
                paths:
                  type: array
                  minItems: 1
                  items:
                    type: string
                updateInterval:
                  type: string
                  format: "iso8601-duration"
      

  messages:
    commandError:
      title: Command Error
      summary: a message send if data in a command is invalid
      contentType: application/json
      payload:
        type: object
        required:
          - type
          - error
          - receivedCommand
        properties: 
          type:
            type: string
            enum:
              - error
          relatedTo:
            type:
              - string
              - integer
            description: the id of the message that made the error happen
          error:
            type: string
          receivedCommand:
            type: object
            additionalProperties: true

    subscribe:
      title: Subscribe
      contentType: application/json
      payload:
        $ref: "#/components/schemas/subscribe"

    
    statusUpdate:
      title: Status Update
      contentType: application/json
      payload:
        type: array
        items:
          type: object
          required:
            - path
            - lastUpdate
            - status
          properties: 
            path:
              type: string
            lastUpdate:
              type: string
              format: date-time
            status:
              type: string
              enum:
                - ok
                - limited
                - down

        

        

        

    
        